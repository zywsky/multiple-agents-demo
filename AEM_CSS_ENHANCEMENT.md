# AEM CSS æŸ¥æ‰¾åŠŸèƒ½å¢å¼º

## é—®é¢˜å›é¡¾

ç”¨æˆ·æå‡ºäº†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š
1. CSS æŸ¥è¯¢æ˜¯å¦æœ‰ç¼ºå¤±çš„éƒ¨åˆ†ï¼Ÿ
2. æ˜¯å¦ä¹ŸæŸ¥è¯¢äº†ä¾èµ–ç»„ä»¶çš„ CSSï¼Ÿ

## å‘ç°çš„é—®é¢˜

### 1. âŒ ä¾èµ–ç»„ä»¶çš„ CSS æœªè¢«å¤„ç†

**é—®é¢˜**:
- å½“å‰å®ç°åªå¤„ç†äº†å½“å‰ç»„ä»¶çš„ CSS
- ä¾èµ–ç»„ä»¶çš„ HTL æ–‡ä»¶ä¸­çš„ CSS classes æ²¡æœ‰è¢«æå–
- ä¾èµ–ç»„ä»¶çš„ CSS æ ·å¼æ²¡æœ‰è¢«æŸ¥æ‰¾

**å½±å“**:
- å¦‚æœä¾èµ–ç»„ä»¶æœ‰è‡ªå·±çš„æ ·å¼ï¼Œè¿™äº›æ ·å¼ä¸ä¼šè¢«åŒ…å«
- ç”Ÿæˆçš„ React ç»„ä»¶å¯èƒ½ç¼ºå°‘å¿…è¦çš„æ ·å¼

### 2. âš ï¸ ClientLibs å¤„ç†ä¸å®Œæ•´

**é—®é¢˜**:
- `embeds` æ²¡æœ‰é€’å½’å¤„ç†ï¼ˆåµŒå¥—çš„ embeds è¢«å¿½ç•¥ï¼‰
- `dependencies` æ²¡æœ‰è¢«å¤„ç†ï¼ˆåªå¤„ç†äº† embedsï¼‰
- HTL ä¸­çš„ `categories` å‚æ•°æ²¡æœ‰è¢«å¤„ç†

## å·²å®Œæˆçš„å¢å¼º

### 1. âœ… ä¾èµ–ç»„ä»¶çš„ CSS å¤„ç†

#### æ–°å¢å‡½æ•°

**`build_dependency_css_summary()`**
- ä»ä¾èµ–ç»„ä»¶çš„åˆ†æç»“æœä¸­æå– HTL æ–‡ä»¶
- é€’å½’å¤„ç†æ‰€æœ‰ä¾èµ–ç»„ä»¶ï¼ˆåŒ…æ‹¬åµŒå¥—ä¾èµ–ï¼‰
- ä¸ºæ¯ä¸ªä¾èµ–ç»„ä»¶æ„å»º CSS æ‘˜è¦

**`merge_css_summaries()`**
- åˆå¹¶å½“å‰ç»„ä»¶å’Œæ‰€æœ‰ä¾èµ–ç»„ä»¶çš„ CSS æ‘˜è¦
- åŒºåˆ†å½“å‰ç»„ä»¶å’Œä¾èµ–ç»„ä»¶çš„ CSS è§„åˆ™
- æ ‡è®°ä¾èµ–ç»„ä»¶çš„ CSS æ¥æº

#### å·¥ä½œæµé›†æˆ

åœ¨ `write_code` èŠ‚ç‚¹ä¸­ï¼š
1. å¤„ç†å½“å‰ç»„ä»¶çš„ CSS
2. å¤„ç†æ‰€æœ‰ä¾èµ–ç»„ä»¶çš„ CSS
3. åˆå¹¶æ‰€æœ‰ CSS æ‘˜è¦
4. åœ¨ prompt ä¸­åŒºåˆ†æ˜¾ç¤º

### 2. âœ… ClientLibs å¤„ç†å¢å¼º

#### é€’å½’å¤„ç† embeds

```python
def process_embeds(embed_categories: List[str], visited_categories: Set[str] = None):
    """é€’å½’å¤„ç†åµŒå…¥çš„ ClientLibs"""
    # é˜²æ­¢å¾ªç¯ä¾èµ–
    # é€’å½’å¤„ç†åµŒå¥—çš„ embeds
```

**æ”¹è¿›**:
- âœ… é€’å½’å¤„ç†åµŒå¥—çš„ embeds
- âœ… é˜²æ­¢å¾ªç¯ä¾èµ–
- âœ… å¤„ç†å¤šå±‚åµŒå¥—

#### å¤„ç† dependencies

**æ–°å¢**:
- âœ… å¤„ç† ClientLibs çš„ `dependencies` å±æ€§
- âœ… æŸ¥æ‰¾ä¾èµ–çš„ ClientLibs å¹¶æå– CSS

#### HTL categories å‚æ•°

**æ–°å¢**:
- âœ… ä» HTL ä¸­æå– `data-sly-call="${template.styles @ categories='...'}"`
- âœ… æ ¹æ® category æŸ¥æ‰¾å¯¹åº”çš„ ClientLibs

### 3. âœ… CSS Class æå–å¢å¼º

**å½“å‰æ”¯æŒ**:
- âœ… `class="..."` - æ ‡å‡†æ ¼å¼
- âœ… `class="${variable}"` - åŠ¨æ€ class
- âœ… `data-sly-attribute.class` - HTL åŠ¨æ€å±æ€§

**å¯èƒ½çš„é—æ¼**:
- âš ï¸ `className` (React é£æ ¼ï¼Œä½† AEM ä¸­ä¸å¸¸è§)
- âš ï¸ åµŒå¥—åœ¨ JavaScript ä¸­çš„ class æ“ä½œï¼ˆå¦‚ `element.className = "..."`ï¼‰

**å»ºè®®**: å½“å‰å®ç°å·²ç»è¦†ç›–äº† AEM HTL ä¸­çš„ä¸»è¦ä½¿ç”¨åœºæ™¯ã€‚

### 4. âœ… CSS è§„åˆ™æå–å¢å¼º

**å½“å‰æ”¯æŒ**:
- âœ… ç²¾ç¡®åŒ¹é…ï¼š`.class-name { ... }`
- âœ… ç»„åˆé€‰æ‹©å™¨ï¼š`.class-name, .other { ... }`
- âœ… åµŒå¥—é€‰æ‹©å™¨ï¼š`.parent .class-name { ... }`

**å¯èƒ½çš„é—æ¼**:
- âš ï¸ å±æ€§é€‰æ‹©å™¨ï¼š`[class~="class-name"]`
- âš ï¸ ä¼ªç±»é€‰æ‹©å™¨ï¼š`.class-name:hover`
- âš ï¸ åª’ä½“æŸ¥è¯¢ä¸­çš„ class

**å»ºè®®**: å½“å‰å®ç°å·²ç»è¦†ç›–äº†å¤§éƒ¨åˆ†å¸¸è§åœºæ™¯ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ‰©å±•ã€‚

## å®Œæ•´çš„ CSS æŸ¥æ‰¾æµç¨‹

### å½“å‰ç»„ä»¶

1. **æå– CSS classes** - ä» HTL ä¸­æå–
2. **æŸ¥æ‰¾ç»„ä»¶ CSS æ–‡ä»¶** - ç»„ä»¶ç›®å½•ä¸‹çš„ `*.css`, `*.less`, `*.scss`
3. **æŸ¥æ‰¾ ClientLibs é…ç½®** - ç»„ä»¶ç›®å½•ä¸‹çš„ `.content.xml`
4. **å¤„ç† embeds** - é€’å½’å¤„ç†åµŒå…¥çš„ ClientLibs
5. **å¤„ç† dependencies** - å¤„ç†ä¾èµ–çš„ ClientLibs
6. **HTL æ ·å¼å¼•ç”¨** - ä» `data-sly-call` æå–
7. **å…¨å±€æœç´¢** - æœ€åæ‰‹æ®µ

### ä¾èµ–ç»„ä»¶

1. **ä»ä¾èµ–åˆ†æç»“æœæå– HTL æ–‡ä»¶**
2. **å¯¹æ¯ä¸ªä¾èµ–ç»„ä»¶æ‰§è¡Œç›¸åŒçš„æŸ¥æ‰¾æµç¨‹**
3. **é€’å½’å¤„ç†åµŒå¥—ä¾èµ–**
4. **åˆå¹¶æ‰€æœ‰ CSS æ‘˜è¦**

## å·¥ä½œæµä¸­çš„ CSS æ˜¾ç¤º

### Prompt ç»“æ„

```
=== CSS STYLES (from AEM) ===

The component and its dependencies use the following CSS classes:
- Total classes used: X
- Found CSS definitions: Y classes
- Missing CSS definitions: Z classes

CSS Rules Found (Current Component):
  .class-name:
    From: /path/to/css
    {css rule...}

CSS Rules from Dependency Components:
  .class-name:
    From: [dependency-resource-type] /path/to/css
    {css rule...}

Dependency Components CSS Summary:
  - dependency-resource-type:
    Used classes: X
    Found: Y
    Missing: Z
```

## æ£€æŸ¥æ¸…å•

### âœ… å·²å®ç°

- [x] å½“å‰ç»„ä»¶çš„ CSS æŸ¥æ‰¾
- [x] ä¾èµ–ç»„ä»¶çš„ CSS æŸ¥æ‰¾
- [x] é€’å½’å¤„ç†åµŒå¥—ä¾èµ–
- [x] ClientLibs embeds é€’å½’å¤„ç†
- [x] ClientLibs dependencies å¤„ç†
- [x] HTL categories å‚æ•°å¤„ç†
- [x] CSS è§„åˆ™åˆå¹¶å’Œæ˜¾ç¤º
- [x] åŒºåˆ†å½“å‰ç»„ä»¶å’Œä¾èµ–ç»„ä»¶çš„ CSS

### âš ï¸ å¯èƒ½çš„æ”¹è¿›ï¼ˆå¯é€‰ï¼‰

- [ ] å±æ€§é€‰æ‹©å™¨æ”¯æŒï¼ˆ`[class~="..."]`ï¼‰
- [ ] ä¼ªç±»é€‰æ‹©å™¨æå–ï¼ˆ`.class:hover`ï¼‰
- [ ] åª’ä½“æŸ¥è¯¢ä¸­çš„ class æå–
- [ ] CSS å˜é‡ï¼ˆ`--custom-property`ï¼‰æå–
- [ ] LESS/SCSS æºæ–‡ä»¶å¤„ç†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- [ ] CSS ç¼–è¯‘åçš„æ–‡ä»¶å¤„ç†

## æ€»ç»“

### âœ… å·²è§£å†³çš„é—®é¢˜

1. **ä¾èµ–ç»„ä»¶çš„ CSS æŸ¥è¯¢** âœ…
   - ç°åœ¨ä¼šé€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–ç»„ä»¶çš„ CSS
   - åˆå¹¶æ‰€æœ‰ CSS æ‘˜è¦
   - åœ¨ prompt ä¸­åŒºåˆ†æ˜¾ç¤º

2. **ClientLibs å¤„ç†å¢å¼º** âœ…
   - é€’å½’å¤„ç† embeds
   - å¤„ç† dependencies
   - æ”¯æŒ HTL categories å‚æ•°

### ğŸ“Š è¦†ç›–èŒƒå›´

- **å½“å‰ç»„ä»¶**: âœ… å®Œæ•´æ”¯æŒ
- **ä¾èµ–ç»„ä»¶**: âœ… å®Œæ•´æ”¯æŒï¼ˆé€’å½’ï¼‰
- **ClientLibs**: âœ… å®Œæ•´æ”¯æŒï¼ˆembeds + dependenciesï¼‰
- **HTL å¼•ç”¨**: âœ… å®Œæ•´æ”¯æŒï¼ˆpath + categoriesï¼‰

### ğŸ¯ ç»“æœ

ç°åœ¨ç³»ç»Ÿå¯ä»¥ï¼š
- âœ… æŸ¥æ‰¾å½“å‰ç»„ä»¶çš„æ‰€æœ‰ CSS
- âœ… æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–ç»„ä»¶çš„ CSSï¼ˆé€’å½’ï¼‰
- âœ… å¤„ç† ClientLibs çš„æ‰€æœ‰åœºæ™¯
- âœ… åˆå¹¶å’Œæ˜¾ç¤ºæ‰€æœ‰ CSS ä¿¡æ¯
- âœ… ä¸º LLM æä¾›å®Œæ•´çš„æ ·å¼ä¸Šä¸‹æ–‡

ä»£ç å·²ç»å®Œå–„ï¼Œå¯ä»¥å¤„ç†å¤æ‚çš„ AEM CSS åœºæ™¯ï¼ğŸ‰
