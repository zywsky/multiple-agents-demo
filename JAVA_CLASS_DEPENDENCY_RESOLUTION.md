# Javaç±»ä¾èµ–é€’å½’æŸ¥æ‰¾åŠŸèƒ½

## é—®é¢˜æè¿°

åœ¨AEMé¡¹ç›®ä¸­ï¼ŒJava Sling Modelç±»å¯èƒ½ä¼šï¼š
1. **ç»§æ‰¿å…¶ä»–ç±»** (`extends BaseComponentModel`)
2. **å¼•ç”¨å…¶ä»–è‡ªå®šä¹‰ç±»** (å­—æ®µç±»å‹ã€æ–¹æ³•å‚æ•°ç­‰)
3. **ä½¿ç”¨å·¥å…·ç±»** (`ButtonHelper`)

ä¸ºäº†å®Œæ•´ç†è§£Javaç±»çš„åŠŸèƒ½ï¼Œéœ€è¦é€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–çš„Javaç±»ã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. å¢å¼º `parse_java_file()` å‡½æ•°

**æ–°å¢æå–å†…å®¹**:
- `extends`: ç»§æ‰¿çš„çˆ¶ç±»
- `imports`: å¯¼å…¥çš„ç±»åˆ—è¡¨
- `referenced_classes`: å¼•ç”¨çš„è‡ªå®šä¹‰ç±»ï¼ˆåŒä¸€é¡¹ç›®ä¸‹çš„ï¼‰

**å®ç°é€»è¾‘**:
- æå– `extends` å…³é”®å­—åçš„ç±»å
- æå–æ‰€æœ‰ `import` è¯­å¥
- ä»importsä¸­ç­›é€‰é¡¹ç›®å†…çš„ç±»ï¼ˆ`com.example.*`ï¼‰
- åœ¨ä»£ç ä¸­æŸ¥æ‰¾è¿™äº›ç±»çš„ä½¿ç”¨ï¼ˆå­—æ®µç±»å‹ã€newå®ä¾‹åŒ–ç­‰ï¼‰
- å¤„ç†åŒä¸€åŒ…ä¸‹çš„ç±»ï¼ˆå¯èƒ½æ²¡æœ‰importï¼‰

### 2. æ–°å¢ `find_java_class_dependencies()` å‡½æ•°

**åŠŸèƒ½**: é€’å½’æŸ¥æ‰¾Javaç±»çš„æ‰€æœ‰ä¾èµ–ç±»

**æŸ¥æ‰¾ç­–ç•¥**:
1. æŸ¥æ‰¾çˆ¶ç±»ï¼ˆ`extends`ï¼‰
2. æŸ¥æ‰¾å¼•ç”¨çš„è‡ªå®šä¹‰ç±»ï¼ˆå­—æ®µç±»å‹ã€æ–¹æ³•å‚æ•°ç­‰ï¼‰
3. é€’å½’æŸ¥æ‰¾ä¾èµ–ç±»çš„ä¾èµ–
4. é˜²æ­¢å¾ªç¯ä¾èµ–
5. é™åˆ¶é€’å½’æ·±åº¦ï¼ˆé»˜è®¤5å±‚ï¼‰

**å‚æ•°**:
- `java_file_path`: Javaæ–‡ä»¶è·¯å¾„
- `aem_repo_path`: AEM repositoryæ ¹è·¯å¾„
- `visited`: å·²è®¿é—®çš„ç±»é›†åˆï¼ˆé˜²æ­¢å¾ªç¯ä¾èµ–ï¼‰
- `max_depth`: æœ€å¤§é€’å½’æ·±åº¦

**è¿”å›**: ä¾èµ–ç±»çš„åˆ†æç»“æœåˆ—è¡¨

### 3. æ–°å¢ `_find_java_class_path()` å‡½æ•°

**åŠŸèƒ½**: æ ¹æ®ç±»åæŸ¥æ‰¾Javaæ–‡ä»¶è·¯å¾„

**æŸ¥æ‰¾ç­–ç•¥**:
1. å¦‚æœæ˜¯å®Œæ•´ç±»åï¼ˆåŒ…å«åŒ…åï¼‰ï¼Œè½¬æ¢ä¸ºè·¯å¾„æŸ¥æ‰¾
2. å¦‚æœæ˜¯ç®€å•ç±»åï¼Œå…ˆå°è¯•åŒä¸€åŒ…ä¸‹
3. æ”¯æŒå¤šç§ç›®å½•ç»“æ„ï¼š
   - `src/main/java/`
   - `core/src/main/java/`
   - ç»„ä»¶ç›®å½•ä¸‹ï¼ˆæµ‹è¯•æ•°æ®ï¼‰

### 4. å¢å¼º `_extract_referenced_classes()` å‡½æ•°

**åŠŸèƒ½**: æå–å¼•ç”¨çš„è‡ªå®šä¹‰ç±»

**æå–ç­–ç•¥**:
1. ä»importsä¸­ç­›é€‰é¡¹ç›®å†…çš„ç±»
2. åœ¨ä»£ç ä¸­æŸ¥æ‰¾ç±»çš„ä½¿ç”¨ï¼š
   - å­—æ®µç±»å‹ï¼š`private ButtonHelper helper;`
   - newå®ä¾‹åŒ–ï¼š`new ButtonHelper()`
   - èµ‹å€¼å®ä¾‹åŒ–ï¼š`helper = new ButtonHelper()`
3. å¤„ç†extendsä¸­çš„ç±»ï¼ˆåŒä¸€åŒ…ä¸‹çš„ç±»å¯èƒ½æ²¡æœ‰importï¼‰
4. å¤„ç†å­—æ®µç±»å‹ä¸­çš„è‡ªå®šä¹‰ç±»

## æµ‹è¯•æ•°æ®

### åˆ›å»ºçš„æµ‹è¯•æ•°æ®

1. **BaseComponentModel.java** - åŸºç¡€ç»„ä»¶æ¨¡å‹
   - åŒ…å«é€šç”¨åŠŸèƒ½ï¼ˆid, cssClass, visibleï¼‰
   - è¢«ButtonModelç»§æ‰¿

2. **ButtonHelper.java** - æŒ‰é’®å·¥å…·ç±»
   - åŒ…å«éªŒè¯ã€æ ¼å¼åŒ–ç­‰æ–¹æ³•
   - è¢«ButtonModelä½¿ç”¨

3. **ButtonModel.java** - æ›´æ–°åçš„æŒ‰é’®æ¨¡å‹
   - ç»§æ‰¿ `BaseComponentModel`
   - ä½¿ç”¨ `ButtonHelper`

### ä¾èµ–å…³ç³»

```
ButtonModel
â”œâ”€â”€ extends BaseComponentModel
â””â”€â”€ uses ButtonHelper
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•

```python
from utils.java_analyzer import parse_java_file, find_java_class_dependencies

# è§£æJavaæ–‡ä»¶
java_file = 'components/example-button/ButtonModel.java'
analysis = parse_java_file(java_file)

# æŸ¥çœ‹å¼•ç”¨çš„ç±»
print(f"ç»§æ‰¿: {analysis.get('extends')}")
print(f"å¼•ç”¨çš„ç±»: {analysis.get('referenced_classes')}")

# é€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–
aem_repo = '/path/to/aem/repo'
dependencies = find_java_class_dependencies(java_file, aem_repo)

# å¤„ç†æ‰€æœ‰ä¾èµ–ç±»
all_classes = [analysis] + dependencies
for cls in all_classes:
    print(f"{cls['package']}.{cls['class_name']}")
    print(f"  å­—æ®µ: {len(cls['fields'])}")
    print(f"  æ–¹æ³•: {len(cls['methods'])}")
```

### åœ¨å·¥ä½œæµä¸­é›†æˆ

```python
# åœ¨ analyze_aem_files èŠ‚ç‚¹ä¸­
java_files = [f for f in files if f.endswith('.java')]
all_java_analyses = []

for java_file in java_files:
    # è§£æå½“å‰æ–‡ä»¶
    analysis = parse_java_file(java_file)
    all_java_analyses.append(analysis)
    
    # æŸ¥æ‰¾ä¾èµ–ç±»
    dependencies = find_java_class_dependencies(java_file, aem_repo_path)
    all_java_analyses.extend(dependencies)

# æ„å»ºå®Œæ•´çš„Javaåˆ†ææ‘˜è¦
java_summary = build_java_analysis_summary(all_java_analyses)
```

## åŠŸèƒ½ç‰¹ç‚¹

### âœ… å·²å®ç°çš„åŠŸèƒ½

1. **æå–ç»§æ‰¿å…³ç³»** - è¯†åˆ« `extends` å…³é”®å­—
2. **æå–importè¯­å¥** - è·å–æ‰€æœ‰å¯¼å…¥çš„ç±»
3. **è¯†åˆ«é¡¹ç›®å†…çš„ç±»** - ç­›é€‰ `com.example.*` ç­‰
4. **æŸ¥æ‰¾ç±»ä½¿ç”¨** - åœ¨ä»£ç ä¸­æŸ¥æ‰¾ç±»çš„ä½¿ç”¨ä½ç½®
5. **é€’å½’æŸ¥æ‰¾ä¾èµ–** - é€’å½’æŸ¥æ‰¾ä¾èµ–ç±»çš„ä¾èµ–
6. **é˜²æ­¢å¾ªç¯ä¾èµ–** - ä½¿ç”¨visitedé›†åˆé˜²æ­¢æ— é™å¾ªç¯
7. **é™åˆ¶é€’å½’æ·±åº¦** - é»˜è®¤æœ€å¤š5å±‚
8. **å»é‡å¤„ç†** - é¿å…é‡å¤åˆ†æåŒä¸€ä¸ªç±»

### ğŸ“Š æ”¯æŒçš„åœºæ™¯

1. **ç»§æ‰¿å…³ç³»** - `class ButtonModel extends BaseComponentModel`
2. **å­—æ®µç±»å‹** - `private ButtonHelper helper;`
3. **newå®ä¾‹åŒ–** - `new ButtonHelper()`
4. **åŒä¸€åŒ…ä¸‹çš„ç±»** - å¯èƒ½æ²¡æœ‰import
5. **ä¸åŒåŒ…ä¸‹çš„ç±»** - é€šè¿‡importå¼•ç”¨

## å·¥ä½œæµé›†æˆå»ºè®®

### åœ¨ `analyze_aem_files` èŠ‚ç‚¹ä¸­

1. åˆ†æå½“å‰ç»„ä»¶çš„Javaæ–‡ä»¶
2. å¯¹æ¯ä¸ªJavaæ–‡ä»¶ï¼Œé€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–ç±»
3. åˆå¹¶å½“å‰ç±»å’Œä¾èµ–ç±»çš„åˆ†æç»“æœ
4. åœ¨promptä¸­åŒºåˆ†æ˜¾ç¤ºï¼š
   - å½“å‰ç»„ä»¶çš„Javaç±»
   - ä¾èµ–çš„Javaç±»ï¼ˆç»§æ‰¿ã€å¼•ç”¨ï¼‰

### åœ¨ `write_code` èŠ‚ç‚¹ä¸­

1. ä½¿ç”¨å®Œæ•´çš„Javaåˆ†æç»“æœï¼ˆåŒ…æ‹¬ä¾èµ–ç±»ï¼‰
2. åœ¨promptä¸­è¯´æ˜ï¼š
   - å½“å‰ç»„ä»¶ç»§æ‰¿çš„ç±»
   - å½“å‰ç»„ä»¶ä½¿ç”¨çš„å·¥å…·ç±»
   - è¿™äº›ä¾èµ–ç±»çš„å­—æ®µå’Œæ–¹æ³•

## æ€»ç»“

### âœ… å·²è§£å†³çš„é—®é¢˜

1. **Javaç±»ä¾èµ–æŸ¥æ‰¾** âœ…
   - ç°åœ¨å¯ä»¥é€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–çš„Javaç±»
   - æ”¯æŒç»§æ‰¿å…³ç³»å’Œå¼•ç”¨å…³ç³»
   - é˜²æ­¢å¾ªç¯ä¾èµ–

2. **å®Œæ•´ç†è§£Javaç±»åŠŸèƒ½** âœ…
   - å¯ä»¥ç†è§£ç»§æ‰¿çš„çˆ¶ç±»çš„åŠŸèƒ½
   - å¯ä»¥ç†è§£ä½¿ç”¨çš„å·¥å…·ç±»çš„åŠŸèƒ½
   - å¯ä»¥å®Œæ•´æ„å»ºTypeScriptæ¥å£

### ğŸ“Š è¦†ç›–èŒƒå›´

- **ç»§æ‰¿å…³ç³»**: âœ… å®Œæ•´æ”¯æŒ
- **å¼•ç”¨å…³ç³»**: âœ… å®Œæ•´æ”¯æŒï¼ˆå­—æ®µã€æ–¹æ³•å‚æ•°ç­‰ï¼‰
- **åŒä¸€åŒ…ä¸‹çš„ç±»**: âœ… å®Œæ•´æ”¯æŒ
- **ä¸åŒåŒ…ä¸‹çš„ç±»**: âœ… å®Œæ•´æ”¯æŒï¼ˆé€šè¿‡importï¼‰
- **é€’å½’æŸ¥æ‰¾**: âœ… å®Œæ•´æ”¯æŒï¼ˆé˜²æ­¢å¾ªç¯ä¾èµ–ï¼‰

ç°åœ¨ç³»ç»Ÿå¯ä»¥å®Œæ•´ç†è§£Javaç±»çš„æ‰€æœ‰ä¾èµ–å…³ç³»ï¼ğŸ‰
